---
import Layout from "../layouts/Layout.astro";
import { siteConfig } from "../config";

const totalPapers = siteConfig.publications.reduce((sum, yr) => sum + yr.papers.length, 0);
const totalAwards = siteConfig.publications.reduce(
  (sum, yr) => sum + yr.papers.filter((p) => p.award).length, 0
);
const venues = new Set(siteConfig.publications.flatMap((yr) => yr.papers.map((p) => p.venue)));

// Bold Ren√©'s name in author string
function formatAuthors(authors: string): string {
  return authors.replace(/R\. Dorsch/g, '<strong>R. Dorsch</strong>');
}
---

<Layout title="Writer" currentPage="/writer/">
  <section class="pt-12 pb-20 px-4">
    <div class="max-w-5xl mx-auto">
      <div class="reveal section-label mb-3">Academic Output</div>
      <h2 class="reveal text-3xl sm:text-4xl font-bold tracking-tight mb-4" style="color: var(--color-primary-dark);">Publications</h2>
      <div class="accent-divider reveal mb-12"></div>

      <!-- Blog -->
      {siteConfig.blog && siteConfig.blog.length > 0 && (
        <div class="mb-16">
          <div class="reveal section-label mb-3">Blog</div>
          <h3 class="reveal text-2xl font-bold tracking-tight mb-6" style="color: var(--color-primary-dark);">Latest Writing</h3>
          <div class="space-y-4">
            {siteConfig.blog.map((post, i) => (
              <div class={`reveal card-hover glass-card-solid p-6 sm:p-8 stagger-${i + 1}`}>
                <div class="flex flex-wrap items-center gap-3 mb-3">
                  <span class="text-xs font-mono" style="color: var(--color-primary-light);">{post.date}</span>
                  <span class="text-xs font-mono" style="color: var(--color-accent);">{post.readTime}</span>
                </div>
                <h4 class="text-lg sm:text-xl font-bold mb-3" style="color: var(--color-primary-dark);">{post.title}</h4>
                <p class="text-sm leading-relaxed mb-4" style="color: var(--color-primary);">{post.excerpt}</p>
                <div class="flex flex-wrap gap-2">
                  {post.tags.map((tag) => (
                    <span class="text-[0.65rem] font-mono px-3 py-1 rounded-lg" style="background: var(--color-accent-dim); color: var(--color-accent);">
                      {tag}
                    </span>
                  ))}
                </div>
              </div>
            ))}
          </div>
          <div class="accent-divider reveal mt-12 mb-6"></div>
        </div>
      )}

      <!-- Stats bar -->
      <div class="reveal grid grid-cols-3 gap-4 mb-14">
        <div class="stat-card glass-card-solid p-6 text-center">
          <div class="text-3xl sm:text-4xl font-bold" style="font-family: 'Space Grotesk'; color: var(--color-primary-dark);">{totalPapers}</div>
          <div class="text-[0.65rem] uppercase tracking-widest font-medium mt-1" style="color: var(--color-primary-light);">Papers</div>
        </div>
        <div class="stat-card glass-card-solid p-6 text-center">
          <div class="text-3xl sm:text-4xl font-bold" style="font-family: 'Space Grotesk'; color: var(--color-accent);">{totalAwards}</div>
          <div class="text-[0.65rem] uppercase tracking-widest font-medium mt-1" style="color: var(--color-primary-light);">Awards</div>
        </div>
        <div class="stat-card glass-card-solid p-6 text-center">
          <div class="text-3xl sm:text-4xl font-bold" style="font-family: 'Space Grotesk'; color: var(--color-primary-dark);">{venues.size}+</div>
          <div class="text-[0.65rem] uppercase tracking-widest font-medium mt-1" style="color: var(--color-primary-light);">Venues</div>
        </div>
      </div>

      <!-- Publications by year -->
      {siteConfig.publications.map((yearGroup) => (
        <div class="mb-12">
          <div class="reveal flex items-center gap-4 mb-6">
            <span class="text-2xl font-bold font-mono" style="color: var(--color-primary-dark);">{yearGroup.year}</span>
            <div class="flex-1 h-px" style="background: var(--color-surface);"></div>
            <span class="text-xs font-mono" style="color: var(--color-primary-light);">{yearGroup.papers.length} paper{yearGroup.papers.length > 1 ? 's' : ''}</span>
          </div>
          <div class="space-y-3">
            {yearGroup.papers.map((paper, i) => (
              <a
                href={paper.url}
                target="_blank"
                rel="noopener"
                class={`reveal pub-card glass-card-solid p-5 sm:p-6 stagger-${Math.min(i + 1, 6)} ${paper.award ? 'award' : ''} block no-underline cursor-pointer`}
              >
                <h4 class="text-sm sm:text-base font-semibold leading-snug mb-2 link-hover inline" style="color: var(--color-primary-dark);">
                  {paper.title}
                  <svg class="inline-block w-3.5 h-3.5 ml-1 opacity-40" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
                </h4>
                <div class="flex flex-wrap items-center gap-x-4 gap-y-1">
                  <span class="text-xs font-mono font-semibold" style="color: var(--color-accent);">{paper.venue}</span>
                  <span class="text-xs" style="color: var(--color-primary-light);" set:html={formatAuthors(paper.authors)} />
                </div>
                {paper.award && (
                  <div class="mt-3 inline-flex items-center gap-2 text-xs font-bold px-3 py-1.5 rounded-lg" style="background: var(--color-accent); color: #fff;">
                    <span>&#9733;</span>
                    {paper.award}
                  </div>
                )}
              </a>
            ))}
          </div>
        </div>
      ))}

      <!-- Key Venues -->
      <div class="reveal mt-16 glass-card-solid p-8 text-center">
        <p class="section-label justify-center mb-5">Key Venues</p>
        <div class="flex flex-wrap justify-center gap-3">
          {["ESWC", "ACM IoT", "ICPM", "KGSWC", "CAiSE", "APMS"].map((venue) => (
            <span class="text-sm font-mono px-5 py-2 rounded-xl font-medium" style="background: var(--color-surface); color: var(--color-primary);">
              {venue}
            </span>
          ))}
        </div>
      </div>
    </div>
  </section>
</Layout>
